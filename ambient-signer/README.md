# Ambient Signer

A minimal dependencies crate for signing and sending payloads to Ambient Exchange. This crate is extracted from the core permit system and provides only the essential functionality needed for signing operations.

## Features

- **Minimal Dependencies**: Only includes necessary dependencies for signing operations
- **Ed25519 Signing**: Support for Ed25519 signature generation with optional feature
- **Borsh Serialization**: Uses Borsh for deterministic serialization
- **Hex Utilities**: Helper functions for hex string conversion
- **Compatible**: Works with Solana ecosystem (solana-program)

## Usage

Add this to your `Cargo.toml`:

```toml
[dependencies]
ambient-signer = { path = "../ambient-signer" }
```

### Basic Example with File-based Keypair

```rust
use ambient_signer::{
    PermitEnvelopeV1, PermitDomain, ClusterType, PermitAction, 
    KeyType, ReplayMode, TimeInForce, sign_permit_ed25519, bytes_to_hex
};
use solana_program::pubkey::Pubkey;
use ed25519_dalek::{Keypair, SecretKey, PublicKey};
use std::fs;

// Read keypair from JSON file (generated by solana-keygen new --outfile keypair.json)
let keypair_json = fs::read_to_string("keypair.json")?;
let keypair_bytes: Vec<u8> = serde_json::from_str(&keypair_json)?;

// Convert to Ed25519 keypair (first 32 bytes are secret key)
let secret_key = SecretKey::from_bytes(&keypair_bytes[..32])?;
let public_key = PublicKey::from(&secret_key);
let keypair = Keypair { secret: secret_key, public: public_key };

// Create a permit envelope
let envelope = PermitEnvelopeV1 {
    domain: PermitDomain {
        program_id: Pubkey::new_unique(),
        cluster: ClusterType::Testnet,
        version: 1,
    },
    authorizer: Pubkey::new_unique(),
    key_type: KeyType::Ed25519,
    action: PermitAction::Noop,
    mode: ReplayMode::HlWindow { k: 128 },
    expires_unix: 1_700_000_000,
    max_fee_quote: 0,
    relayer: None,
    nonce: 42,
};

// Sign the permit
let signed = sign_permit_ed25519(&envelope, &keypair).unwrap();
let (payload_bytes, signature) = signed.into_parts();

// payload_bytes and signature can now be sent to /exchange
println!("Payload: {}", hex::encode(&payload_bytes));
println!("Signature: {}", hex::encode(&signature));
```

### Place Order Example

```rust
use ambient_signer::{PermitAction, HealthFloor, HealthMetric, TimeInForce};

let place_order_action = PermitAction::Place {
    market_id: 1,
    client_id: 12345,
    side: 0, // 0 = Bid, 1 = Ask
    qty: 1000000, // Quantity in base units
    price: Some(50000), // Limit price
    tif: TimeInForce::GTC,
    reduce_only: false,
    trigger_price: None,
    trigger_type: 0,
    health_floor: Some(HealthFloor {
        metric: HealthMetric::Initial,
        min: 0,
    }),
};
```

## Dependencies

- `borsh = "0.9.3"` - For serialization
- `solana-program = "1.18.26"` - For Pubkey and program utilities  
- `ed25519-dalek = "1.0"` - For Ed25519 signing (optional, behind `permit-signing` feature)
- `hex = "0.4.3"` - For hex string utilities
- `rand = "0.7"` - For keypair generation
- `serde_json = "1.0"` - For parsing Solana keypair JSON files

## Features

- `permit-signing` (default): Enables Ed25519 signing functionality

## License

MIT OR Apache-2.0